# 1、加水印

处理前：

 <img src="assets/image-20201113170307369.jpg" alt="image-2 0201113 170307369" style="zoom:80%;" />



处理后：

 <img src="assets/image-20201113170353557.jpg" alt="image-202011131703 53557" style="zoom:80%;" />



代码：

```java
import sun.misc.BASE64Encoder;
import javax.imageio.ImageIO;
import java.awt.*;
import java.awt.image.BufferedImage;
import java.io.ByteArrayOutputStream;
import java.io.File;
import java.io.FileOutputStream;
import java.net.URL;

public class Test {

    /**
     * 申请表添加水印
     * @param srcImgPath    图片原地址
     * @param tarImgPath    处理后的图片的地址
     * @param xm            收件人姓名
     * @param yzbm          邮寄编码
     * @param sjdz  收件地址
     * @param sjhm  收件号码
     * @param hpzl  号牌种类
     * @param hphm  号牌号码
     * @param rq    日期
     * @param qmtp  签名图片
     * @param markContentColor  签名颜色
     * @param font  签名字体
     * @return   处理后的图片的base64字符串
     * @throws Exception .
     */
    public String addWaterMarkSqb(String srcImgPath, String tarImgPath, String xm,String yzbm,String sjdz,String sjhm, String hpzl,
                                  String hphm, String rq,String qmtp, Color markContentColor,Font font) throws Exception {

        String str = "";
        try {
            // 读取原图片信息
            File srcImgFile = new File(srcImgPath);//得到文件
            Image srcImg = ImageIO.read(srcImgFile);//文件转化为图片
            int srcImgWidth = srcImg.getWidth(null);//获取图片的宽
            int srcImgHeight = srcImg.getHeight(null);//获取图片的高
            System.out.println(srcImgHeight +","+srcImgWidth);

            // 加水印
            BufferedImage bufImg = new BufferedImage(srcImgWidth, srcImgHeight, BufferedImage.TYPE_INT_RGB);
            Graphics2D g = bufImg.createGraphics();
            g.drawImage(srcImg, 0, 0, srcImgWidth, srcImgHeight, null);
            g.setColor(markContentColor); //根据图片的背景设置水印颜色
            g.setFont(font); //设置字体

            //画出水印，参数含义（水印内容，水印坐标 x轴，水印坐标y轴）
            g.drawString(xm,300,230);//申请人姓名
            g.drawString(yzbm,690,230);//邮政编码
            g.drawString(sjdz,300,280);//收件地址
            g.drawString(sjhm,300,330);//手机号码
            g.drawString(hphm,590,505);//号牌号码
            g.drawString(hpzl,200,505);//号牌种类
            g.drawString(rq,630,1080);//受理网点

            //签名图片
            URL url = new URL(qmtp);
            BufferedImage bufferedImage = ImageIO.read(url);
            // 参数分别为：插入图片的bufferedImage对象，插入图片的x轴坐标，y轴坐标，插入图片的宽，高
            // 若不指定插入图片的新宽高，默认用原图的宽高
            g.drawImage(bufferedImage,430,1023,50,50,null);

            g.dispose();
            // 输出图片
            FileOutputStream outImgStream = new FileOutputStream(tarImgPath);
            ImageIO.write(bufImg, "jpg", outImgStream);
            System.out.println("添加水印完成");
            outImgStream.flush();
            outImgStream.close();

            //输出流
            ByteArrayOutputStream outputStream = new ByteArrayOutputStream();
            ImageIO.write(bufferedImage,"jpg",outputStream);
            BASE64Encoder encoder = new BASE64Encoder();
            str = encoder.encode(outputStream.toByteArray());


        } catch (Exception e) {
            throw new Exception(e);
        }
        return str;
    }

    public static void main(String[] args) throws Exception {

        // 处理委托书
        File directory = new File("yshop-ewt-app/src/main/resources/image/");
        String reportPath = directory.getCanonicalPath();//获取resources文件夹的绝对路径
        Color color=new Color(255,0,0,128); //水印图片色彩以及透明度
        String xm ="叶珍";  //水印内容

        //处理申请表
        Font font2 = new Font("黑体", Font.ITALIC, 20);//水印字体
        String srcImgPath2= reportPath + "/申请表.jpg"; //源图片地址
        String tarImgPath2= reportPath + "/sqb.jpg"; //待存储的地址

        String base642 = new Test().addWaterMarkSqb(srcImgPath2,tarImgPath2,xm,"510000","广东省 广州市 天河区 林和中路xx号","15622206336",
                "摩托车","粤123456","2020年12月12日","https://img-home.csdnimg.cn/images/20200629060547.png",color,font2);
        System.out.println(base642);

    }
}  
```

